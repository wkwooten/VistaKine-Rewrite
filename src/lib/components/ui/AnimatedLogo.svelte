<script lang="ts">
  import VectorOutputPanel from "./../visualization/interactions/vector-builder/VectorOutputPanel.svelte";
  import { onMount } from "svelte";
  import { animate, stagger, svg } from "animejs";

  let container: SVGElement | null = null;

  onMount(() => {
    if (!container) {
      console.error("AnimatedLogo: Container not found");
      return;
    }
    console.log("AnimatedLogo: onMount started, container found.");

    const mainLinesSelector = ".logo-line";
    const mainLinesExist = container?.querySelector(mainLinesSelector);

    if (mainLinesExist) {
      console.log("AnimatedLogo: Animating main lines.");
      animate(svg.createDrawable(mainLinesSelector), {
        draw: ["0 0", "0 1"], // Simple draw animation
        duration: 4000, // Duration in ms
        delay: stagger(50), // Delay between each path animation
        easing: "easeInOutSine",
        loop: false,
      });
    } else {
      console.warn(
        "AnimatedLogo: Main lines (.logo-line) not found for animation."
      );
    }

    // Arrowhead fade-in using CSS transition
    const arrowheadSelector = "g#Vector polygon.logo-fill";
    const arrowheadElement = container?.querySelector(
      arrowheadSelector
    ) as HTMLElement;
    console.log(
      "AnimatedLogo: Arrowhead selector:",
      arrowheadSelector,
      "Element found:",
      arrowheadElement
    );
    if (arrowheadElement) {
      setTimeout(() => {
        console.log(
          "AnimatedLogo: Attempting to make arrowhead visible. Current classes:",
          arrowheadElement.classList.toString()
        );
        // Force browser to apply initial styles before adding 'visible' class
        void arrowheadElement.offsetHeight;
        arrowheadElement.classList.add("visible");
        console.log(
          "AnimatedLogo: Arrowhead classes after adding 'visible':",
          arrowheadElement.classList.toString()
        );
      }, 2800); // Start after main lines are mostly drawn
    } else {
      console.warn("AnimatedLogo: Arrowhead element not found.");
    }

    // Tagline "Physics & Mechanics" fade-in using CSS transition with stagger
    const taglineSelector = "g#Tagline path.logo-fill";
    const taglineElements = container?.querySelectorAll(taglineSelector);
    console.log(
      "AnimatedLogo: Tagline selector:",
      taglineSelector,
      "Elements found count:",
      taglineElements?.length
    );
    if (taglineElements && taglineElements.length > 0) {
      taglineElements.forEach((element, index) => {
        const el = element as HTMLElement;
        setTimeout(
          () => {
            console.log(
              `AnimatedLogo: Attempting to make tagline element ${index} visible. Current classes:`,
              el.classList.toString()
            );
            // Force reflow for each element
            void el.offsetHeight;
            el.classList.add("visible");
            console.log(
              `AnimatedLogo: Tagline element ${index} classes after adding 'visible':`,
              el.classList.toString()
            );
          },
          3000 + index * 70
        ); // Staggered fade-in, starts as main lines near completion
      });
    } else {
      console.warn("AnimatedLogo: Tagline elements not found.");
    }
  });
</script>

<!-- Updated SVG with the final logo -->
<svg
  bind:this={container}
  id="Layer_1"
  data-name="Layer 1"
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 345.8486 116.6871"
  aria-labelledby="vistaKineLogoTitle"
  role="img"
  class="hero-logo-svg"
>
  <title id="vistaKineLogoTitle">VistaKine Animated Logo</title>
  <g id="logo">
    <g id="Main">
      <path
        class="cls-1 logo-line"
        d="m1.2607,12.358h12.3838l14.4258,42.333h.1318l14.4258-42.333h12.1865l-19.4316,51.8662h-14.7559L1.2607,12.358Z"
      />
      <path
        class="cls-1 logo-line"
        d="m59.292,12.358h10.8027v9.7334h-10.8027v-9.7334Zm0,14.5332h10.8027v37.333h-10.8027V26.8912Z"
      />
      <path
        class="cls-1 logo-line"
        d="m79.5801,60.8239c-1.4492-1.666-2.042-3.7998-2.042-7.4658v-1.0674h10.8037v.4004c0,1.667.1973,2.5996,1.0537,3.2666.7246.5996,2.042,1,5.8623,1,3.5576,0,5.4678-.2666,6.4551-.9336.8564-.5996,1.0547-1.4668,1.0547-2.666,0-1.7334-.3955-2.6006-1.5811-3-.791-.2666-1.6465-.4004-8.168-.8672-5.9287-.3994-10.2764-.8662-12.4502-2.5332-2.042-1.5332-3.0957-3.7998-3.0957-8.4668,0-4.7324,1.251-7.5332,3.5566-9.2656,2.9648-2.2666,6.9824-2.9336,13.7012-2.9336,8.5635,0,12.7139,1.2002,15.1514,3.9336,1.6465,1.7998,2.1074,4.2666,2.1074,7.5332v.666h-10.6055v-.0664c0-1.5332-.1318-2.4668-.9883-3.1338-.9873-.7998-2.7666-1.0664-5.665-1.0664-3.1611,0-4.874.2002-5.7305.8672-.7246.5332-.9883,1.1992-.9883,2.5996,0,1.7334.5273,2.4004,1.3838,2.7334s2.3057.4668,6.6533.7998c8.0361.5996,11.9229,1,14.2275,2.5996,2.5039,1.7334,3.2939,4.7334,3.2939,8.7334,0,4.7998-1.1201,7.5332-3.6885,9.4668-2.7666,2.0664-7.2461,2.8662-14.624,2.8662-9.4199,0-13.3057-1.2666-15.6777-4Z"
      />
      <path
        class="cls-1 logo-line"
        d="m122.7256,53.6246v-18.2666h-4.7432v-8.4668h4.7432v-9.1992h10.8027v9.1992h9.1562v8.4668h-9.1562v16.3994c0,2.8672.791,3.4004,4.4141,3.4004h4.7422v9.0664h-9.2881c-8.1016,0-10.6709-3.2666-10.6709-10.5996Z"
      />
      <path
        class="cls-1 logo-line"
        d="m147.7558,52.8912c0-8.9336,4.4131-11.2666,16.9951-11.2666h9.0908v-1.9336c0-4.1328-1.5811-5.3994-7.0488-5.3994-5.665,0-7.0479,1.1328-7.0479,4.666v.1338h-10.54v-.667c0-8.9326,4.4131-12.1328,17.3906-12.1328,13.3057,0,17.8516,3.5332,17.8516,12.7334v25.1992h-10.6055v-4.7998h-.1318c-1.4492,3.3994-3.1621,5.333-12.0547,5.333-10.0791,0-13.8994-3.5996-13.8994-11.8662Zm17.7197,3.5996c5.665,0,8.4971-.7334,8.4971-5.333v-2.9336h-8.2334c-5.7314,0-7.3115.7998-7.3115,4.2666,0,2.9336,1.3174,4,7.0479,4Z"
      />
      <path
        class="cls-1 logo-line"
        d="m193.1416,12.358h11.4609v20.5996h5.0068l16.8633-20.5996h13.5039l-20.75,25,22.4629,26.8662h-14.2285l-17.8516-21.5996h-5.0068v21.5996h-11.4609V12.358Z"
      />
      <path
        class="cls-1 logo-line"
        d="m244.9814,12.358h10.8027v9.7334h-10.8027v-9.7334Zm0,14.5332h10.8027v37.333h-10.8027V26.8912Z"
      />
      <path
        class="cls-1 logo-line"
        d="m264.2158,26.8912h10.7373v5.334h.1318c1.4492-3.9336,4.5449-5.8672,11.5938-5.8672,9.8799,0,13.5693,4.1338,13.5693,14.333v23.5332h-10.8027v-21.1992c0-6.2002-1.6475-7.4004-6.9824-7.4004-6.4561,0-7.4443,1.2666-7.4443,8.0664v20.5332h-10.8027V26.8912Z"
      />
      <path
        class="cls-1 logo-line"
        d="m307.2285,45.6246c0-14.7998,4.4141-19.333,19.1689-19.333,14.624,0,18.5762,4.4668,18.5762,19v3.333h-27.0078v.8662c0,5.5332,1.4492,6.9336,8.6299,6.9336,5.9941,0,7.6406-1.0664,7.6406-4.0664v-.1338h10.7373v.667c0,8.4668-4.7432,11.9326-18.4443,11.9326-14.8867,0-19.3008-4.333-19.3008-19.1992Zm27.0742-4.0664v-.4668c0-4.8672-1.252-6.4004-7.9053-6.4004-7.0479,0-8.4316,1.4668-8.4316,6.8672h16.3369Z"
      />
    </g>
    <g id="Line">
      <line
        class="cls-2 logo-line"
        x1="3.664"
        y1="80.6491"
        x2="345.664"
        y2="80.6491"
      />
    </g>
    <!-- arrow head -->
    <g id="Vector">
      <line
        class="cls-3 logo-line"
        x1=".3153"
        y1="3.8883"
        x2="49.4918"
        y2="3.8883"
      />
      <polygon
        class="cls-4 logo-fill"
        points="46.5428 7.7766 48.1947 3.8883 46.5428 0 55.7598 3.8883 46.5428 7.7766"
      />
    </g>
    <g id="Tagline">
      <path
        class="cls-4 logo-fill"
        d="m37.8131,91.7604h9.6748c5.002,0,6.7354,1.7041,6.7354,6.333,0,4.6553-1.7334,6.3594-6.7354,6.3594h-7.5645v7.0967h-2.1104v-19.7891Zm9.5244,10.7334c3.7197,0,4.7754-1.0684,4.7754-4.4004,0-3.3066-1.0557-4.375-4.7754-4.375h-7.4141v8.7754h7.4141Z"
      />
      <path
        class="cls-4 logo-fill"
        d="m59.0484,91.7604v8.0625h.0508c.5029-1.4238,1.6836-2.3652,4.8252-2.3652,3.9453,0,5.3525,1.6533,5.3525,5.0615v9.0303h-1.9854v-8.5723c0-2.6201-.9297-3.6885-3.9199-3.6885-3.3682,0-4.3232,1.043-4.3232,4.1211v8.1396h-1.96v-19.7891h1.96Z"
      />
      <path
        class="cls-4 logo-fill"
        d="m71.8902,114.983h1.8848c1.5586,0,1.9102-.2539,2.5137-1.7295l.6533-1.5518-5.8057-14.0664h2.1611l4.625,11.5742h.1006l4.5986-11.5742h2.0859l-6.6846,16.3564c-.8545,2.085-1.7344,2.6953-4.0215,2.6953h-2.1113v-1.7041Z"
      />
      <path
        class="cls-4 logo-fill"
        d="m86.9693,110.4049c-.6279-.6865-.9043-1.501-.9043-2.8994v-.4834h1.9854v.3301c0,.9414.2012,1.5264.6533,1.959.5527.5088,1.5078.6611,3.5684.6611,1.8096,0,2.9912-.0762,3.5693-.6104.4014-.3564.5771-.8652.5771-1.6279,0-.8652-.2002-1.374-.5771-1.6787-.4775-.3818-1.4082-.5596-3.9463-.6865-2.7139-.1533-4.0459-.4326-4.7744-1.0938-.6289-.585-.9297-1.4502-.9297-2.7988,0-1.373.3262-2.2891,1.0049-2.8994.9297-.8643,2.4629-1.1191,4.8506-1.1191,2.6387,0,4.0459.3564,4.9258,1.2207.6279.6611.8545,1.5771.8545,2.8496v.1777h-1.9609v-.0254c0-.9922-.2256-1.5264-.5781-1.832-.5273-.5088-1.6836-.6611-3.2412-.6611-1.6836,0-2.7646.1016-3.3428.6357-.3516.3311-.5273.8145-.5273,1.5264,0,.8398.1504,1.1953.502,1.501.4531.3818,1.3066.5342,3.5938.6611,3.041.1787,4.373.4326,5.1777,1.1445.7031.6357.9541,1.6787.9541,2.9512,0,1.4492-.3262,2.3906-1.0547,3.0264-.9307.8398-2.5391,1.0938-5.0771,1.0938-2.9902,0-4.3975-.3809-5.3027-1.3223Z"
      />
      <path
        class="cls-4 logo-fill"
        d="m101.4703,91.7604h1.96v3.1533h-1.96v-3.1533Zm0,5.875h1.96v13.9141h-1.96v-13.9141Z"
      />
      <path
        class="cls-4 logo-fill"
        d="m106.7232,104.5797c0-5.418,1.4326-7.1221,6.459-7.1221,4.4229,0,6.5342,1.0684,6.5342,5.291v.127h-1.9854v-.0508c0-3.002-1.3828-3.5107-4.5488-3.5107-3.5938,0-4.4482.9414-4.4482,5.2656,0,4.3496.8545,5.2656,4.4482,5.2656,3.4424,0,4.5986-.5596,4.5986-3.8154v-.0508h1.9854v.127c0,4.5527-1.9854,5.6211-6.584,5.6211-5.0264,0-6.459-1.7041-6.459-7.1475Z"
      />
      <path
        class="cls-4 logo-fill"
        d="m123.3092,110.4049c-.6279-.6865-.9043-1.501-.9043-2.8994v-.4834h1.9854v.3301c0,.9414.2012,1.5264.6533,1.959.5527.5088,1.5078.6611,3.5684.6611,1.8096,0,2.9912-.0762,3.5693-.6104.4014-.3564.5771-.8652.5771-1.6279,0-.8652-.2002-1.374-.5771-1.6787-.4775-.3818-1.4082-.5596-3.9463-.6865-2.7139-.1533-4.0459-.4326-4.7744-1.0938-.6289-.585-.9297-1.4502-.9297-2.7988,0-1.373.3262-2.2891,1.0049-2.8994.9297-.8643,2.4629-1.1191,4.8506-1.1191,2.6387,0,4.0459.3564,4.9258,1.2207.6279.6611.8545,1.5771.8545,2.8496v.1777h-1.9609v-.0254c0-.9922-.2256-1.5264-.5781-1.832-.5273-.5088-1.6836-.6611-3.2412-.6611-1.6836,0-2.7646.1016-3.3428.6357-.3516.3311-.5273.8145-.5273,1.5264,0,.8398.1504,1.1953.502,1.501.4531.3818,1.3066.5342,3.5938.6611,3.041.1787,4.373.4326,5.1777,1.1445.7031.6357.9541,1.6787.9541,2.9512,0,1.4492-.3262,2.3906-1.0547,3.0264-.9307.8398-2.5391,1.0938-5.0771,1.0938-2.9902,0-4.3975-.3809-5.3027-1.3223Z"
      />
      <path
        class="cls-4 logo-fill"
        d="m144.6207,105.6481c0-3.0781.6035-4.7314,2.8145-5.5195-1.2061-1.043-1.6084-2.1113-1.6084-3.9678,0-3.6377,1.709-4.7822,7.1631-4.7822,5.4277,0,7.0869,1.1445,7.0869,4.8838v.916h-2.0605v-.7637c0-2.5186-.9307-3.1035-4.9766-3.1035-4.1719,0-5.1016.5596-5.1016,2.9258,0,1.373.3271,2.0088,1.3818,2.7979l9.8018,7.4023c.0254-.3057.0254-.6113.0254-.9414v-3.8662h2.0605v4.0186c0,.8398-.0508,1.5771-.1514,2.2383l3.0664,2.3154-1.2061,1.6787-2.6387-2.0098c-1.0811,1.501-3.2422,2.0605-7.3643,2.0605-6.8604,0-8.293-1.5518-8.293-6.2832Zm8.3438,4.3496c3.292,0,4.8506-.3564,5.5791-1.4238l-9.5498-7.2246c-1.96.5342-2.2871,1.7295-2.2871,4.1465,0,3.5352.7539,4.502,6.2578,4.502Z"
      />
      <path
        class="cls-4 logo-fill"
        d="m173.1695,91.7604h3.3418l8.2188,17.4238h.0498l8.2178-17.4238h3.3428v19.7891h-2.0361v-17.7295h-.0244l-8.3691,17.7295h-2.3125l-8.3682-17.7295h-.0508v17.7295h-2.0098v-19.7891Z"
      />
      <path
        class="cls-4 logo-fill"
        d="m199.859,104.6051c0-5.418,1.2822-7.1475,6.6094-7.1475,4.9004,0,6.3584,1.501,6.3584,6.2578v1.5254h-10.9824c.0254,3.8154.7539,4.7314,4.8252,4.7314,3.0908,0,4.1719-.585,4.1719-2.9502v-.1279h1.96v.1787c0,3.5859-1.6836,4.6543-6.1572,4.6543-5.5029,0-6.7852-1.7041-6.7852-7.1221Zm10.9824-1.1191v-.3818c0-3.001-.8799-3.8916-4.373-3.8916-3.6943,0-4.5732.9414-4.624,4.2734h8.9971Z"
      />
      <path
        class="cls-4 logo-fill"
        d="m215.7164,104.5797c0-5.418,1.4326-7.1221,6.459-7.1221,4.4229,0,6.5342,1.0684,6.5342,5.291v.127h-1.9854v-.0508c0-3.002-1.3828-3.5107-4.5488-3.5107-3.5938,0-4.4482.9414-4.4482,5.2656,0,4.3496.8545,5.2656,4.4482,5.2656,3.4424,0,4.5986-.5596,4.5986-3.8154v-.0508h1.9854v.127c0,4.5527-1.9854,5.6211-6.584,5.6211-5.0264,0-6.459-1.7041-6.459-7.1475Z"
      />
      <path
        class="cls-4 logo-fill"
        d="m233.9107,91.7604v8.0625h.0508c.5029-1.4238,1.6836-2.3652,4.8252-2.3652,3.9453,0,5.3525,1.6533,5.3525,5.0615v9.0303h-1.9854v-8.5723c0-2.6201-.9297-3.6885-3.9199-3.6885-3.3682,0-4.3232,1.043-4.3232,4.1211v8.1396h-1.96v-19.7891h1.96Z"
      />
      <path
        class="cls-4 logo-fill"
        d="m247.1304,107.4801c0-3.0781,1.8096-4.1465,5.9561-4.1465h4.4229v-.916c0-2.5693-.9297-3.2305-3.9951-3.2305-2.7402,0-3.9463.4072-3.9463,2.6709v.1016h-1.96v-.2539c0-3.332,1.9102-4.248,5.8809-4.248,4.4482,0,5.9814,1.1953,5.9814,4.8584v9.2334h-1.9609v-2.0605h-.0244c-.5283,1.2979-1.3574,2.2383-4.9512,2.2383-3.6689,0-5.4033-1.1445-5.4033-4.2471Zm5.8809,2.4922c3.418,0,4.5234-.9668,4.5234-3.5869v-1.3223h-4.2979c-3.1162,0-4.1211.5596-4.1211,2.3906,0,2.0098,1.1562,2.5186,3.8955,2.5186Z"
      />
      <path
        class="cls-4 logo-fill"
        d="m263.1383,97.6354h1.96v2.1875h.0508c.5029-1.4238,1.6836-2.3652,4.8252-2.3652,3.9453,0,5.3525,1.6533,5.3525,5.0615v9.0303h-1.9854v-8.5723c0-2.6201-.9297-3.6885-3.9199-3.6885-3.3682,0-4.3232,1.043-4.3232,4.1211v8.1396h-1.96v-13.9141Z"
      />
      <path
        class="cls-4 logo-fill"
        d="m278.9713,91.7604h1.96v3.1533h-1.96v-3.1533Zm0,5.875h1.96v13.9141h-1.96v-13.9141Z"
      />
      <path
        class="cls-4 logo-fill"
        d="m284.2232,104.5797c0-5.418,1.4326-7.1221,6.459-7.1221,4.4229,0,6.5342,1.0684,6.5342,5.291v.127h-1.9854v-.0508c0-3.002-1.3828-3.5107-4.5488-3.5107-3.5938,0-4.4482.9414-4.4482,5.2656,0,4.3496.8545,5.2656,4.4482,5.2656,3.4424,0,4.5986-.5596,4.5986-3.8154v-.0508h1.9854v.127c0,4.5527-1.9854,5.6211-6.584,5.6211-5.0264,0-6.459-1.7041-6.459-7.1475Z"
      />
      <path
        class="cls-4 logo-fill"
        d="m300.8092,110.4049c-.6279-.6865-.9043-1.501-.9043-2.8994v-.4834h1.9854v.3301c0,.9414.2012,1.5264.6533,1.959.5527.5088,1.5078.6611,3.5684.6611,1.8096,0,2.9912-.0762,3.5693-.6104.4014-.3564.5771-.8652.5771-1.6279,0-.8652-.2002-1.374-.5771-1.6787-.4775-.3818-1.4082-.5596-3.9463-.6865-2.7139-.1533-4.0459-.4326-4.7744-1.0938-.6289-.585-.9297-1.4502-.9297-2.7988,0-1.373.3262-2.2891,1.0049-2.8994.9297-.8643,2.4629-1.1191,4.8506-1.1191,2.6387,0,4.0459.3564,4.9258,1.2207.6279.6611.8545,1.5771.8545,2.8496v.1777h-1.9609v-.0254c0-.9922-.2256-1.5264-.5781-1.832-.5273-.5088-1.6836-.6611-3.2412-.6611-1.6836,0-2.7646.1016-3.3428.6357-.3516.3311-.5273.8145-.5273,1.5264,0,.8398.1504,1.1953.502,1.501.4531.3818,1.3066.5342,3.5938.6611,3.041.1787,4.373.4326,5.1777,1.1445.7031.6357.9541,1.6787.9541,2.9512,0,1.4492-.3262,2.3906-1.0547,3.0264-.9307.8398-2.5391,1.0938-5.0771,1.0938-2.9902,0-4.3975-.3809-5.3027-1.3223Z"
      />
    </g>
  </g>
</svg>

<style lang="scss">
  .hero-logo-svg {
    width: 100%;
    /* max-width: 100%; */
    height: auto;
    display: block;
    margin-block: var(--space-l);
  }

  /* Keep styles for the animated line/stroke */
  .hero-logo-svg .logo-line {
    stroke: var(--color-accent);
    stroke-width: 1.75px; /* Match new SVG stroke width */
    fill: none;
    stroke-linecap: round;
    stroke-linejoin: round;
  }

  .hero-logo-svg .logo-fill {
    fill: var(--color-accent);
    stroke: none;
    /* opacity: 0; */ // Temporarily commented out for visibility
    transition: opacity 0.5s ease-out; /* Adjust duration/easing as needed */
  }

  .logo-fill.visible {
    opacity: 1;
  }
</style>
